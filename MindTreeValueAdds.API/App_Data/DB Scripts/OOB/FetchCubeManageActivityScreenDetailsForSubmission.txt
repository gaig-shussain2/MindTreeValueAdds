SELECT 
Q.POL_NO, 
Q.POL_MOD, 
Q.POL_VERSION, 
p.POL_SYMBOL_CD,
s.current_transaction_part_no, 
s.total_transaction_part_cnt,
trans.item_desc_short Activity,
s.TRANSACTION_PROCESS_TS, 
Q.SUBMISSION_ID,
RPM.SEARCH_VALUE CubeAPRP

from  RAMT.rpm_search RPM
inner join RAMT.quote Q
on Q.QUOTE_ID=RPM.ROW_KEY
inner join ramt.submission s 
on s.SUBMISSION_ID=Q.SUBMISSION_ID
inner join ramt.policy p
on s.policy_id = p.policy_id 
inner join ramt.ud_ref sys 
on s.SYS_TRANS_TYPE_REF_ID = sys.ud_ref_id
inner join ramt.ud_ref trans
on s.trans_type_ref_id = trans.ud_ref_id

where RPM.SEARCH_NAME in ('TOTAPRPPremium')
and row_key in 
(
	select QUOTE_ID from RAMT.quote where SUBMISSION_ID in 
		(
			select s.submission_id from ramt.submission s, ramt.policy p, ramt.ud_ref trans, ramt.ud_ref sys, ramt.ud_ref soa 
				where s.policy_id = p.policy_id  
				and s.SYS_TRANS_TYPE_REF_ID = sys.ud_ref_id
				and s.trans_type_ref_id = trans.ud_ref_id
				and s.soa_ref_id = soa.ud_ref_id
				and p.pol_no in ('&POL_NO_CD')
				and p.POL_MOD in ('&POL_MODULE_CD')
				and p.POL_VERSION in ('&POL_VERSION_CD')
				and s.submission_id in ('&SUBMISSION_ID')
				and soa.item_desc_short not in ('Obsolete')
		)
)
order by POL_NO, POL_MOD, POL_VERSION, TRANSACTION_PROCESS_TS,s.CURRENT_TRANSACTION_PART_NO