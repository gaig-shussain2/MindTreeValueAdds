
@{
    /**/

    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<br />
<br />
<h3 class="text-center">Extract Session Data</h3>
<h5 class="text-center">Sample Desc.</h5>

@*<div>
        <h5 style="color:red;"><b>Note:</b></h5>
        <h6>Use Submission Id text box to extract data submission wise. It will help us to extract data for huge policy.</h6>
        <h6>Append "<b>X</b>" at the end of the policy (e.g. CAP 000000 00 00 <b>X</b>) to get transaction level data and avoid coverage level data from EDW/ADW.</h6>
    </div>*@

@*<hr />
    <div class="container text-right label-default" style="padding-top:5px; padding-bottom:5px;">
        <a href="#" style="color:white;">Click here access tool's:</a>
    </div>*@
<hr />

<div>
    <section>
        <div class="container">
            <form method="post">
                <div class="form-horizontal">
                    <div class="col-md-12">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="Server">Select Server</label>
                                <label style="color:red;">*</label>
                                @Html.DropDownList("Server", null, new { @id = "Server", @class = "form-control", @name = "Server" })
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="OrigionalSubmissionID">Enter Origional Submission ID</label>
                                <label style="color:red;">*</label>
                                <input type="number" class="form-control" id="OrigionalSubmissionID" placeholder="123456789" name="Origional Submission ID" autocomplete="off">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="SubmissionID">Enter Submission ID</label>
                                <label style="color:red;">*</label>
                                <input type="number" class="form-control" id="SubmissionID" placeholder="123456789" name="SubmissionID" autocomplete="off">
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="VersionNumber">Enter Version Number</label>
                                <label style="color:red;">*</label>
                                <input type="number" class="form-control" id="VersionNumber" placeholder="1" name="VersionNumber" autocomplete="off" min="1" max="9">
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <button type="button" class="btn btn-primary" id="btn_Submit">Submit</button>
                        <button type="button" class="btn btn-danger" id="btn_Clear">Clear</button>
                    </div>
                </div>
            </form>
        </div>
    </section>

    <section>
        <div class="container">
            <br />
            <div style="text-align: right;">
                <h4><b>Result Section</b></h4>
            </div>
            <div style="width:100%; margin:0 auto;" id="ResultDiv"></div>
            <div class="msgclass alert" id="DownloadLink" hidden></div>
        </div>
    </section>
</div>

@* jQuery Version 3.3.1 is obsilated from this project. Adding latest jQuery file referance to fix that. *@
<script src="~/Scripts/jquery-3.6.0.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        function ShowTosterMessage(Type, Title, Alert) {
            var timeOut = 3000;
            var showCloseButton = true;

            if (Type == 'success') {
                toastr.success(Alert, '', { timeOut: timeOut, 'closeButton': showCloseButton });
            }
            else if (Type == 'warning') {
                toastr.warning(Alert, '', { timeOut: timeOut, 'closeButton': showCloseButton });
            }
            else if (Type == 'error') {
                toastr.error(Alert, '', { timeOut: timeOut, 'closeButton': showCloseButton });
            }
        }

        $.fn.ShowMessage = function (addClassVal, message) {
            var a = document.createElement("a");
            a.textContent = message;
            $('#DownloadLink').empty();
            $("#DownloadLink").removeClass('alert-danger');
            $("#DownloadLink").removeClass('alert-warning');
            $("#DownloadLink").removeClass('alert-success');
            $('#DownloadLink').addClass(addClassVal);
            $("#DownloadLink").append(a);
            $('#DownloadLink').show();
        };

        function ValidateScreen() {
            var isValidScreen = true;
            if ($('#OrigionalSubmissionID').val() == '') {
                isValidScreen = false;
                ShowTosterMessage('warning', 'Warning', 'Invalid Origional Submission ID.');
            }

            if ($('#SubmissionID').val() == '') {
                isValidScreen = false;
                ShowTosterMessage('warning', 'Warning', 'Invalid Submission ID.');
            }

            if ($('#VersionNumber').val() == '') {
                isValidScreen = false;
                ShowTosterMessage('warning', 'Warning', 'Invalid Version Number.');
            }

            return isValidScreen;
        }

        $.fn.ClearAll = function () {
            $('#OrigionalSubmissionID').val("");
            $('#OrigionalSubmissionID').prop("disabled", false);

            $('#SubmissionID').val("");
            $('#SubmissionID').prop("disabled", false);

            $('#Server').val("App 12");
            $('#Server').prop("disabled", false);

            $('#VersionNumber').val("1");
            $('#VersionNumber').prop("disabled", false);

            $('#DownloadLink').show = false;
            $('#DownloadLink').empty();
            $("#DownloadLink").removeClass('alert-danger');
            $("#DownloadLink").removeClass('alert-warning');
            $("#DownloadLink").removeClass('alert-success');

            $('#btn_Submit').prop('disabled', false);
        };

        $("#btn_Clear").click(function () {
            $('#element').ClearAll()
        });

        $("#btn_Submit").click(function () {
            var isValidScreen = ValidateScreen();

            if (isValidScreen == true) {
                $('#element').ShowMessage('alert-warning', 'Processing...!')

                $.ajax({
                    type: 'GET',
                    url: '@Url.Action("GenerateReport")',
                    datatype: JSON,
                    data:
                    {
                        'Server': $('#Server').val(),
                        'OriginalSubmissionID': $('#OrigionalSubmissionID').val(),
                        'SubmissionID': $('#SubmissionID').val(),
                        'VersionNumber': $('#VersionNumber').val()
                    },
                    success: function (data) {
                        if (data == '' || data == null) { $('#element').ShowMessage('alert-danger', 'Oops. Error in fatching data from server.'); }
                        else {
                            if (data.includes("==")) {
                                var str1 = data.split('==');
                                window.location = 'Download?FileName=' + str1[1];

                                var eg = 'Download?FileName=' + str1[1];
                                var a = document.createElement("a");
                                a.href = eg;
                                a.textContent = "File Downloded. Click here to download again.";
                                $('#DownloadLink').empty();
                                $("#DownloadLink").removeClass('alert-danger');
                                $("#DownloadLink").removeClass('alert-warning');
                                $('#DownloadLink').addClass('alert-success');
                                $("#DownloadLink").append(a);
                                $('#DownloadLink').show();
                            }
                            else {
                                $('#element').ShowMessage('alert-danger', data);
                            }
                        }
                    },
                    error: function () { $('#element').ShowMessage('alert-danger', 'Oops. Error in fatching data from server.'); }
                });
            }
        });
    });
</script>
